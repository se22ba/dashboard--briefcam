<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Casos Briefcam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- usar librerías locales (offline) -->
  <!--
  <script src="libs/papaparse.min.js"></script>
  <script src="libs/chart.umd.min.js"></script>
  -->

  <!-- usar CDN (rápido para probar) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header>
    <div class="header-left">
      <h1>Dashboard de Casos</h1>
      <p class="header-subtitle">
        Análisis rápido de CSV (starttime, endtime, created, completed, processingtime, status)
      </p>
    </div>
    <div class="controls">
      <label class="file-label">
        <span>Seleccionar CSV</span>
        <input type="file" id="fileInput" accept=".csv" />
      </label>

      <button class="btn" id="loadBtn">Cargar</button>

      <select id="timeRange">
        <option value="30">Últimos 30 min</option>
        <option value="60">Última 1 hora</option>
        <option value="360">Últimas 6 horas</option>
        <option value="720">Últimas 12 horas</option>
        <option value="1440">Últimas 24 horas</option>
        <option value="2880">Últimas 48 horas</option>
        <option value="10080">Últimos 7 días</option>
        <option value="43200" selected>Último mes (~30 días)</option>
      </select>
    </div>
  </header>

  <main>
    <div class="status-row">
      <span id="statusText">Esperando CSV...</span>
    </div>

    <!-- VISTA RELATIVA -->
    <section class="block block-relative">
      <div class="block-header-simple">
        <h2 class="block-title">Vista por ventana relativa</h2>
        <p class="block-subtitle">
          Usa el selector superior (30 min, 1h, 6h, 12h, 24h, 48h, 7d, 1 mes)
        </p>
      </div>

      <section class="kpi-grid">
        <div class="card">
          <h2>Casos creados</h2>
          <div class="value" id="kpiCreatedRel">–</div>
          <div class="subtitle">
            Cantidad de casos con
          </div>
        </div>
        <div class="card">
          <h2>Finalizados OK</h2>
          <div class="value" id="kpiFinishedRel">–</div>
          <div class="subtitle">
            Status exitosos (Finished / Completed / Success)
          </div>
        </div>
        <div class="card">
          <h2>Con error</h2>
          <div class="value" id="kpiErrorRel">–</div>
          <div class="subtitle">
            Status con error/fallo (contiene "error" o "fail")
          </div>
        </div>
        <div class="card">
          <h2>Tiempo promedio</h2>
          <div class="value" id="kpiAvgTimeRel">–</div>
          <div class="subtitle">
            Promedio de <code>completed - created</code> en minutos
          </div>
        </div>
        <div class="card">
          <h2>Horas procesadas</h2>
          <div class="value" id="kpiHoursRel">–</div>
          <div class="subtitle">
            Suma de <code>endtime - starttime</code> en horas
          </div>
        </div>
      </section>

      <section class="charts-grid">
        <div class="card chart-card">
          <div class="card-header">
            <h2>Casos creados por día</h2>
          </div>
          <div class="chart-container">
            <canvas id="createdChartRel"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Finalizados vs Error</h2>
          </div>
          <div class="chart-container">
            <canvas id="finishErrorChartRel"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Distribución de status</h2>
          </div>
          <div class="chart-container">
            <canvas id="statusChartRel"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Horas procesadas por día</h2>
          </div>
          <div class="chart-container">
            <canvas id="hoursChartRel"></canvas>
          </div>
        </div>
      </section>
    </section>

    <!-- VISTA POR RANGO -->
    <section class="block block-range">
      <div class="range-header">
        <div>
          <h2 class="block-title">Vista por rango de fechas</h2>
        </div>
        <div class="range-controls">
          <label>
            <span>Desde</span>
            <input type="datetime-local" id="rangeFrom" />
          </label>
          <label>
            <span>Hasta</span>
            <input type="datetime-local" id="rangeTo" />
          </label>
          <select id="rangeMode">
            <option value="all">Todo el rango</option>
            <option value="30">Últimos 30 min</option>
            <option value="60">Última 1 hora</option>
            <option value="360">Últimas 6 horas</option>
            <option value="720">Últimas 12 horas</option>
            <option value="1440">Últimas 24 horas</option>
            <option value="2880">Últimas 48 horas</option>
            <option value="10080">Últimos 7 días</option>
            <option value="43200">Último mes (~30 días)</option>
          </select>
          <button class="btn btn-secondary" id="applyRangeBtn">Aplicar</button>
        </div>
      </div>

      <section class="kpi-grid">
        <div class="card">
          <h2>Casos creados</h2>
          <div class="value" id="kpiCreatedRange">–</div>
          <div class="subtitle">
            Casos con <code>created</code>
          </div>
        </div>
        <div class="card">
          <h2>Finalizados OK</h2>
          <div class="value" id="kpiFinishedRange">–</div>
          <div class="subtitle">
            Status exitosos
          </div>
        </div>
        <div class="card">
          <h2>Con error</h2>
          <div class="value" id="kpiErrorRange">–</div>
          <div class="subtitle">
            Status con error/fallo
          </div>
        </div>
        <div class="card">
          <h2>Tiempo promedio</h2>
          <div class="value" id="kpiAvgTimeRange">–</div>
          <div class="subtitle">
            Promedio de <code>completed - created</code> en minutos
          </div>
        </div>
        <div class="card">
          <h2>Horas procesadas</h2>
          <div class="value" id="kpiHoursRange">–</div>
          <div class="subtitle">
            Suma de <code>endtime - starttime</code>
          </div>
        </div>
      </section>

      <section class="charts-grid">
        <div class="card chart-card">
          <div class="card-header">
            <h2>Casos creados por día</h2>
          </div>
          <div class="chart-container">
            <canvas id="createdChartRange"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Finalizados vs Error</h2>
          </div>
          <div class="chart-container">
            <canvas id="finishErrorChartRange"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Distribución de status</h2>
          </div>
          <div class="chart-container">
            <canvas id="statusChartRange"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <div class="card-header">
            <h2>Horas procesadas por día</h2>
          </div>
          <div class="chart-container">
            <canvas id="hoursChartRange"></canvas>
          </div>
        </div>

        <!-- NUEVO: gráfico tipo Excel, terminados vs fallas por hora -->
        <div class="card chart-card chart-wide">
          <div class="card-header">
            <h2>Casos creados vs fallas por hora</h2>
          </div>
          <div class="chart-container">
            <canvas id="hourlyChartRange"></canvas>
          </div>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <span>Briefcam Dashboard - Diseño SE22BA</span>
  </footer>

  <script src="js/app.js"></script>
</body>
</html>